<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Thinking Workshop Timezone-Aware Calendar</title>
    <script src='assets/rrule.min.js'></script>
    <!-- fullcalendar bundle -->
    <script src='assets/fc.index.global.min.js'></script>   
    <!-- the rrule-to-fullcalendar connector. must go AFTER the rrule lib -->
    <script src='assets/rrule.connector.min.js'></script>
    <script src='assets/luxon.min.js'></script>
    <link href="style.css" rel="stylesheet">
</head>
<body>

<div id="calendar"></div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
              contentHeight: 'auto',
              timeZone: 'local', 
              displayEventTime: true,
              events: [
                  {
                      title: "COHORT-MAIN",
                      rrule: {
                          freq: "weekly",
                          interval: 1,
                          byweekday: "SA",
                          count: 5,
                          dtstart: new Date(Date.UTC(2024, 10, 14, 16, 0, 0))
                      }
                  },
                  {
                      title: "COHORT-APAC",
                      rrule: {
                          freq: "weekly",
                          interval: 1,
                          byweekday: "SU",
                          count: 5,
                          dtstart: new Date(Date.UTC(2024, 10, 15, 8, 0, 0))
                      }
                  },
              ],
            validRange: {
                start: '2024-11-01',
                end: '2024-12-16'
            },
            eventDidMount: function(info) {
                if (info.event.start && info.el) {
                  let title = "";
                  const year = info.event.start.getFullYear();
                  const month = info.event.start.getMonth()+1;
                  const day = info.event.start.getDate();

                  if(info.event.title === "COHORT-MAIN") {
                    title = "Main<br>" + luxon.DateTime.fromObject(
                      {year, month, day, hour: 17, minute: 0 },
                      { zone: 'Europe/Budapest' }
                    ).setZone(luxon.DateTime.local().zoneName).toFormat('HH:mm');
                  } else {
                    title = "Catchup<br>" + luxon.DateTime.fromObject(
                      { year, month, day, hour: 9, minute: 0 },
                      { zone: 'Europe/Budapest' }
                    ).setZone(luxon.DateTime.local().zoneName).toFormat('HH:mm');
                  }
                  
                  info.el.innerHTML=`<div class="fc-event-title fc-sticky">${title}</div>`;
                }
            },
            datesSet: function(dateInfo) {
                var titleElement = document.querySelectorAll('.fc-toolbar-chunk')[1];
                titleElement.innerHTML = `<h2 class="fc-toolbar-title calendar-title" id="fc-dom-1">Cohort 11</h2>`;
            }
        });
        calendar.render();
    });
</script>

<div id="info-message">Main sessions are 1.5 hours long and recorded.<br>Catchup sessions are 45 minutes long and assume participants have viewed the recording.<br>Time is displayed in 24h format.</div>

</body>
</html>
